<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0c10" />
  <meta name="color-scheme" content="dark" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./icon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="./icon.svg" />
  <title>VocabForge</title>

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#11131a;
      --panel2:#0f1117;
      --text:#e7eaf0;
      --muted:#a7afc0;
      --faint:#7f8798;
      --line:#222636;
      --accent:#7aa2ff;
      --good:#3ddc97;
      --meh:#ffcc66;
      --bad:#ff5c7a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius2: 22px;
      --tap: 52px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg, #07080b 0%, var(--bg) 35%, #07080b 100%);
      color:var(--text);
      font-family:var(--font);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(11,12,16,.86);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(34,38,54,.7);
      padding:16px 16px 12px 16px;
    }
    .toprow{display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:980px;margin:0 auto;}
    .brand{display:flex;flex-direction:column;gap:2px;}
    .brand .title{font-size:18px;font-weight:800;letter-spacing:.2px;}
    .brand .sub{font-size:12px;color:var(--muted);}
    main{padding:14px 16px 96px 16px;}
    .wrap{max-width:980px;margin:0 auto}

    .grid{display:grid;grid-template-columns:1fr;gap:12px;}
    @media (min-width: 860px){.grid{grid-template-columns:1.2fr .8fr;}}

    .card{
      background:linear-gradient(180deg, rgba(17,19,26,.92) 0%, rgba(15,17,23,.92) 100%);
      border:1px solid rgba(34,38,54,.85);
      border-radius:var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{padding:14px 14px 10px 14px;border-bottom:1px solid rgba(34,38,54,.75);display:flex;align-items:center;justify-content:space-between;gap:10px;}
    .card .hd h2{margin:0;font-size:14px;letter-spacing:.2px;color:var(--muted);font-weight:650;text-transform:uppercase;}
    .card .bd{padding:14px}

    .kpiRow{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;}
    .kpi{background:rgba(11,12,16,.6);border:1px solid rgba(34,38,54,.8);border-radius:14px;padding:12px;min-height:74px;}
    .kpi .n{font-size:22px;font-weight:900}
    .kpi .l{font-size:12px;color:var(--muted);margin-top:4px}

    .btnRow{display:flex;gap:10px;flex-wrap:wrap}
    button, .btn{
      appearance:none;border:none;
      background:rgba(122,162,255,.16);
      color:var(--text);
      border:1px solid rgba(122,162,255,.35);
      padding:12px 14px;
      border-radius:16px;
      font-weight:750;
      min-height:var(--tap);
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      user-select:none;
    }
    button:active{transform: translateY(1px)}
    .btn.secondary{background:rgba(17,19,26,.75);border-color:rgba(34,38,54,.9);}
    .btn.good{background:rgba(61,220,151,.16);border-color:rgba(61,220,151,.35)}
    .btn.meh{background:rgba(255,204,102,.14);border-color:rgba(255,204,102,.35)}
    .btn.bad{background:rgba(255,92,122,.14);border-color:rgba(255,92,122,.35)}
    .btn.full{width:100%}
    .btn.small{min-height:44px;padding:10px 12px;border-radius:14px;font-weight:650;font-size:13px}

    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    label{font-size:12px;color:var(--muted);letter-spacing:.2px}
    input[type="text"], input[type="url"], input[type="password"], textarea, select{
      width:100%;
      background:rgba(11,12,16,.65);
      border:1px solid rgba(34,38,54,.9);
      color:var(--text);
      border-radius:16px;
      padding:12px 12px;
      font-size:16px;
      outline:none;
    }
    textarea{min-height:120px; resize:vertical; line-height:1.35}

    .hint{font-size:12px;color:var(--faint);line-height:1.3}
    .hr{height:1px;background:rgba(34,38,54,.85);margin:12px 0}

    .list{display:flex;flex-direction:column;gap:8px;}
    .item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 12px;background:rgba(11,12,16,.55);border:1px solid rgba(34,38,54,.85);border-radius:16px;cursor:pointer;min-height:var(--tap);}
    .item:active{transform: translateY(1px)}
    .w{font-size:16px;font-weight:900;letter-spacing:.2px}
    .meta{font-size:12px;color:var(--muted);margin-top:3px;white-space:pre-wrap}

    .badge{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(34,38,54,.9);background:rgba(17,19,26,.65);color:var(--muted);white-space:nowrap;}

    .tabs{
      position:fixed;left:0;right:0;bottom:0;z-index:10;
      padding:10px 12px calc(10px + env(safe-area-inset-bottom)) 12px;
      background:rgba(11,12,16,.86);
      backdrop-filter: blur(12px);
      border-top:1px solid rgba(34,38,54,.7);
    }
    .tabs .inner{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
    .tab{min-height:50px;border-radius:16px;background:rgba(17,19,26,.65);border:1px solid rgba(34,38,54,.85);color:var(--muted);font-weight:800;font-size:13px;}
    .tab.active{background:rgba(122,162,255,.14);border-color:rgba(122,162,255,.35);color:rgba(225,235,255,.98)}

    .reviewShell{min-height: calc(100vh - 140px); display:flex; flex-direction:column; gap:12px;}
    .reviewCard{flex:1;border-radius:24px;}
    .bigWord{font-size:34px;font-weight:950;letter-spacing:.3px;margin:0 0 10px 0;}
    .blockTitle{font-size:12px;text-transform:uppercase;letter-spacing:.2px;color:var(--muted);margin:14px 0 6px 0;font-weight:800;}
    .para{white-space:pre-wrap;line-height:1.42;color:rgba(231,234,240,.95);font-size:16px;}

    .toast{
      position:fixed;left:50%;bottom:80px;transform:translateX(-50%);
      background:rgba(17,19,26,.92);
      border:1px solid rgba(34,38,54,.9);
      border-radius:999px;
      padding:10px 14px;
      color:var(--text);
      box-shadow: var(--shadow);
      opacity:0;pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
      max-width:min(92vw,760px);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      font-weight:800;z-index:50;
    }
    .toast.on{opacity:1;transform:translateX(-50%) translateY(-4px);}

    .viewer{
      width:100%;
      height:70vh;
      border:1px solid rgba(34,38,54,.85);
      border-radius:16px;
      background:rgba(11,12,16,.55);
      overflow:hidden;
    }
    .viewer iframe{width:100%;height:100%;border:0;}

    .readingSheet{
      background:linear-gradient(180deg, rgba(17,19,26,.96) 0%, rgba(15,17,23,.96) 100%);
      border:1px solid rgba(34,38,54,.85);
      border-radius:var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      max-height: calc(100vh - 160px);
    }
    .sheetToolbar{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      padding:12px 14px;
      border-bottom:1px solid rgba(34,38,54,.75);
      background:rgba(11,12,16,.4);
    }
    .sheetToolbar h2{ margin:0; font-size:14px; letter-spacing:.2px; color:var(--muted); font-weight:650; text-transform:uppercase; }
    .sheetToolbar .spacer{ flex:1; min-width:8px; }
    .sheetToolbar select{ padding:8px 10px; min-height:40px; border-radius:12px; font-size:13px; }
    .sheetScroll{
      overflow:auto;
      flex:1;
      min-height:0;
    }
    .sheetTable{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    .sheetTable th{
      position:sticky;
      top:0;
      z-index:2;
      background:rgba(17,19,26,.98);
      border-bottom:2px solid rgba(34,38,54,.9);
      padding:10px 12px;
      text-align:left;
      font-size:11px;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.25px;
      color:var(--muted);
    }
    .sheetTable td{
      border-bottom:1px solid rgba(34,38,54,.6);
      padding:10px 12px;
      vertical-align:top;
    }
    .sheetTable tbody tr{
      transition:background .12s ease;
    }
    .sheetTable tbody tr:hover{
      background:rgba(122,162,255,.06);
    }
    .sheetTable tbody tr.sheetNewRow{ background:rgba(122,162,255,.08); }
    .sheetTable tbody tr.sheetNewRow:hover{ background:rgba(122,162,255,.1); }
    .sheetTable .colAuthor{ width:14%; min-width:90px; }
    .sheetTable .colTitle{ width:22%; min-width:140px; font-weight:700; color:var(--text); }
    .sheetTable .colDesc{ width:auto; max-width:40%; color:var(--muted); font-size:13px; line-height:1.35; }
    .sheetTable .colStatus{ width:10%; min-width:72px; }
    .sheetTable .colActions{ width:80px; text-align:right; }
    .sheetTable input.cellInput, .sheetTable textarea.cellInput{
      width:100%;
      min-width:0;
      padding:8px 10px;
      font-size:14px;
      border-radius:10px;
      border:1px solid rgba(34,38,54,.8);
      background:rgba(11,12,16,.7);
      color:var(--text);
      outline:none;
    }
    .sheetTable input.cellInput:focus, .sheetTable textarea.cellInput:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(122,162,255,.2);
    }
    .sheetTable textarea.cellInput{ min-height:36px; resize:vertical; line-height:1.3; }
    .sheetTable .cellDesc{ white-space:pre-wrap; word-break:break-word; max-height:3.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; line-clamp:2; -webkit-box-orient:vertical; }
    .sheetTable .statusDot{ display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:6px; }
    .sheetTable .statusDot.TO_READ{ background:var(--faint); }
    .sheetTable .statusDot.READING{ background:var(--accent); }
    .sheetTable .statusDot.DONE{ background:var(--good); }
    .sheetTable .actBtn{ padding:6px 10px; margin-left:4px; border-radius:10px; font-size:12px; font-weight:700; cursor:pointer; border:none; background:rgba(34,38,54,.8); color:var(--muted); }
    .sheetTable .actBtn:hover{ background:rgba(122,162,255,.25); color:var(--text); }
    .sheetTable .actBtn.del:hover{ background:rgba(255,92,122,.2); color:var(--bad); }

    .readingFeedback{
      border-top:1px solid rgba(34,38,54,.75);
      padding:12px 14px;
      background:rgba(11,12,16,.4);
    }
    .readingFeedback summary{ cursor:pointer; font-size:12px; font-weight:700; color:var(--muted); letter-spacing:.2px; user-select:none; }
    .readingFeedback summary:hover{ color:var(--text); }
    .readingFeedback .feedbackBody{ margin-top:10px; }
    .readingFeedback textarea{ min-height:70px; margin-bottom:8px; }
  </style>
</head>
<body>
<header>
  <div class="toprow">
    <div class="brand">
      <div class="title">VocabForge</div>
      <div class="sub">Vocabulary + reading list · offline-first (sync when online)</div>
    </div>
    <div class="brand" style="align-items:flex-end">
      <div class="sub" id="swText">Offline cache: …</div>
      <div class="sub" id="syncText">Sync: …</div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="card">
      <div class="hd"><h2>Home</h2></div>
      <div class="bd">
        <div class="kpiRow">
          <div class="kpi"><div class="n" id="wordCount">0</div><div class="l">Total words</div></div>
        </div>
        <div class="list" id="wordList"></div>
      </div>
    </div>
    <div id="viewRoot"></div>
  </div>
</main>

<nav class="tabs">
  <div class="inner">
    <button class="tab" data-nav="home">Home</button>
    <button class="tab" data-nav="review">Review</button>
    <button class="tab" data-nav="reading">Reading</button>
    <button class="tab" data-nav="keys">Keys</button>
  </div>
</nav>

<div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (sel, el = document) => el.querySelector(sel);
  const esc = (str) => str.replace(/[&<>'"`]/g, (c) => ({'&': '&amp;', '<': '&lt;', '>': '&#39;', '"': '&quot;', '`': '&#96;'}[c]));

  function loadCards() {
    const raw = localStorage.getItem("vocabforge.cards.v3");
    if (!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  }

  function renderHome() {
    const cards = loadCards();
    const wordCount = cards.length;
    const wordList = cards.map((card) => `<div class="item">${esc(card.word)}</div>`).join("");

    $("#wordCount").textContent = wordCount;
    $("#wordList").innerHTML = wordList || '<div class="hint">No words added yet.</div>';
  }

  function renderKeys() {
    const keys = {
      openAIKey: localStorage.getItem("vocabforge.openaiKey.v1") || "Not set",
      githubToken: localStorage.getItem("vocabforge.ghToken.v1") || "Not set",
      gistId: localStorage.getItem("vocabforge.gistId.v1") || "Not set"
    };

    const keysHtml = Object.entries(keys).map(([key, value]) => {
      return `<div class="field"><label>${esc(key)}</label><div>${esc(value)}</div></div>`;
    }).join("");

    $("#viewRoot").innerHTML = `<div class="wrap">${keysHtml}</div>`;
  }

  function render() {
    const view = document.querySelector(".tab.active")?.dataset.nav || "home";
    if (view === "home") renderHome();
    else if (view === "keys") renderKeys();
  }

  document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      render();
    });
  });

  render();
})();
</script>
</body>
</html>
